module.exports={name:"plugin-auto-install",factory:()=>{let l=require("child_process"),g=require("crypto"),r=require("fs"),c=require("path");function p(t){try{let n=g.createHash("sha256"),o=r.statSync(c.join(t.cwd,"yarn.lock"),{throwIfNoEntry:!1});o&&n.update(o.mtimeMs.toString());for(let a of t.workspaces.map(s=>s.cwd).sort()){let s=c.join(a,"package.json"),e=JSON.parse(r.readFileSync(s,"utf-8")),i=Object.keys(e).filter(u=>u.endsWith("ependencies")),h=[];for(let u of i)h.push(...Object.entries(e[u]).map(([k,w])=>`${k}: ${w}`));n.update(h.sort().join(","))}return n.digest("hex")}catch{}}function f(t){let n=y(t);return r.readFileSync(c.join(n,"hash"),"utf-8")}function d(t,n){let o=y(n);r.mkdirSync(o,{recursive:!0}),r.writeFileSync(c.join(o,"hash"),t),r.writeFileSync(c.join(o,".gitignore"),"hash"),console.info(`plugin-auto-install updated hash: ${t}`)}function y(t){return c.join(t.cwd,".yarn","plugins","plugin-auto-install")}return{hooks:{afterAllInstalled(t){try{let n=p(t);n&&d(n,t)}catch{}},async wrapScriptExecution(t,n,o,a,s){try{let e=p(n);try{if(e&&e===f(n))return t}catch{}console.info("plugin-auto-install detects changes in package.json and/or yarn.lock."),e&&d(e,n),l.spawnSync("yarn",["install"],{cwd:s.cwd,env:s.env});let i=l.spawnSync("yarn",[a,s.args],{cwd:s.cwd,env:s.env,stdio:"inherit"});return()=>i.status||0}catch{}return t}}}}};
//# sourceMappingURL=index.cjs.map
