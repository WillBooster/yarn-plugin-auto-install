var S=Object.create;var k=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var b=n=>k(n,"__esModule",{value:!0});var D=(n,o,p,l)=>{if(o&&typeof o=="object"||typeof o=="function")for(let h of H(o))!_.call(n,h)&&(p||h!=="default")&&k(n,h,{get:()=>o[h],enumerable:!(l=v(o,h))||l.enumerable});return n},u=(n,o)=>D(b(k(n!=null?S(F(n)):{},"default",!o&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var m=u(require("child_process")),w=u(require("crypto")),c=u(require("fs")),i=u(require("path"));module.exports={name:"plugin-auto-install",factory:()=>{function n(s){try{let t=w.default.createHash("sha256"),a=c.default.statSync(i.default.join(s.cwd,"yarn.lock"),{throwIfNoEntry:!1});a&&t.update(a.mtimeMs.toString());for(let d of s.workspaces.map(r=>r.cwd).sort()){let r=i.default.join(d,"package.json"),e=JSON.parse(c.default.readFileSync(r,"utf-8")),f=Object.keys(e).filter(y=>y.endsWith("ependencies")),g=[];for(let y of f)g.push(...Object.entries(e[y]).map(([j,P])=>`${j}: ${P}`));t.update(g.sort().join(","))}return t.digest("hex")}catch{}}function o(s){let t=l(s);return c.default.readFileSync(i.default.join(t,"hash"),"utf-8")}function p(s,t){let a=l(t);c.default.mkdirSync(a,{recursive:!0}),c.default.writeFileSync(i.default.join(a,"hash"),s),c.default.writeFileSync(i.default.join(a,".gitignore"),`.gitignore
hash`),console.info(`plugin-auto-install updated hash: ${s}`)}function l(s){return i.default.join(s.cwd,".yarn","plugins","plugin-auto-install")}return{hooks:{afterAllInstalled(s){try{let t=n(s);t&&p(t,s)}catch{}},async wrapScriptExecution(s,t,a,d,r){try{let e=n(t);try{if(e&&e===o(t))return s}catch{}console.info("plugin-auto-install detects changes in package.json and/or yarn.lock."),e&&p(e,t),m.default.spawnSync("yarn",["install"],{cwd:r.cwd,env:r.env});let f=m.default.spawnSync("yarn",[d,...r.args],{cwd:r.cwd,env:r.env,stdio:"inherit",shell:!0});return async()=>f.status||0}catch{}return s}}}}};
//# sourceMappingURL=index.cjs.map
