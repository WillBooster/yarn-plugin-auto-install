"use strict";var n={name:"plugin-auto-install",factory:n=>{const t=n("child_process"),e=n("crypto"),c=n("fs"),r=n("path"),o=`plugin-auto-install v${process.env.VERSION}`;let s=!1,i="";function a(n){try{const t=e.createHash("sha256"),o=r.join(n.cwd,"yarn.lock");c.statSync(o,{throwIfNoEntry:!1})&&t.update(c.readFileSync(o,"utf8"));for(const e of n.workspaces.map((n=>n.cwd)).sort()){const n=r.join(e,"package.json"),o=JSON.parse(c.readFileSync(n,"utf8")),s=Object.keys(o).filter((n=>n.endsWith("ependencies"))),i=[];for(const n of s)i.push(...Object.entries(o[n]).map((([n,t])=>`${n}: ${t}`)));t.update(i.sort().join(","))}return t.digest("hex")}catch{}}function l(n){try{const t=d(n);return c.readFileSync(r.join(t,"hash"),"utf8")}catch{}}function u(n,t){if(!n||n===i)return!1;try{const e=d(t);c.mkdirSync(e,{recursive:!0}),c.writeFileSync(r.join(e,"hash"),n),c.writeFileSync(r.join(e,".gitignore"),".gitignore\nhash"),console.info(`${o} updated dependency hash: ${n}`),i=n}catch{}return!0}function d(n){return r.join(n.cwd,".yarn","plugins","plugin-auto-install")}return{hooks:{validateProject(n){s=!0;const t=a(n);t&&t===l(n)||u(t,n)},afterAllInstalled(n){s=!1;const t=a(n);t&&t===l(n)||u(t,n)},async setupScriptEnvironment(n,e){if(!s)try{const c=a(n);if(c&&c===l(n))return;if(!u(c,n))return;console.info(`${o} is running 'yarn install' due to dependency changes.`),t.spawnSync("yarn",["install"],{cwd:n.cwd,env:e}),console.info(`${o} finished 'yarn install'.`)}catch{}}}}}};module.exports=n;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdmFyLXJlcXVpcmVzICovXG5cbmltcG9ydCB0eXBlIHsgSG9va3MsIFByb2plY3QgfSBmcm9tICdAeWFybnBrZy9jb3JlJztcblxuZXhwb3J0IGRlZmF1bHQge1xuICBuYW1lOiAncGx1Z2luLWF1dG8taW5zdGFsbCcsXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGZhY3Rvcnk6IChpbXBvcnRQYWNrYWdlOiAobmFtZTogc3RyaW5nKSA9PiBhbnkpID0+IHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uXG4gICAgY29uc3QgY2hpbGRfcHJvY2VzcyA9IGltcG9ydFBhY2thZ2UoJ2NoaWxkX3Byb2Nlc3MnKTtcbiAgICBjb25zdCBjcnlwdG8gPSBpbXBvcnRQYWNrYWdlKCdjcnlwdG8nKTtcbiAgICBjb25zdCBmcyA9IGltcG9ydFBhY2thZ2UoJ2ZzJyk7XG4gICAgY29uc3QgcGF0aCA9IGltcG9ydFBhY2thZ2UoJ3BhdGgnKTtcblxuICAgIGNvbnN0IHByZWZpeCA9IGBwbHVnaW4tYXV0by1pbnN0YWxsIHYke3Byb2Nlc3MuZW52LlZFUlNJT059YDtcbiAgICBsZXQgaW5zdGFsbGluZyA9IGZhbHNlO1xuICAgIGxldCBsYXN0SGFzaCA9ICcnO1xuXG4gICAgY29uc3QgaG9va3M6IEhvb2tzID0ge1xuICAgICAgdmFsaWRhdGVQcm9qZWN0KHByb2plY3Q6IFByb2plY3QpIHtcbiAgICAgICAgaW5zdGFsbGluZyA9IHRydWU7XG4gICAgICAgIGNvbnN0IGhhc2ggPSBjYWxjUGFja2FnZUhhc2gocHJvamVjdCk7XG4gICAgICAgIGlmIChoYXNoICYmIGhhc2ggPT09IHJlYWRQYWNrYWdlSGFzaChwcm9qZWN0KSkgcmV0dXJuO1xuXG4gICAgICAgIHdyaXRlUGFja2FnZUhhc2goaGFzaCwgcHJvamVjdCk7XG4gICAgICB9LFxuICAgICAgYWZ0ZXJBbGxJbnN0YWxsZWQocHJvamVjdCkge1xuICAgICAgICBpbnN0YWxsaW5nID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGhhc2ggPSBjYWxjUGFja2FnZUhhc2gocHJvamVjdCk7XG4gICAgICAgIGlmIChoYXNoICYmIGhhc2ggPT09IHJlYWRQYWNrYWdlSGFzaChwcm9qZWN0KSkgcmV0dXJuO1xuXG4gICAgICAgIHdyaXRlUGFja2FnZUhhc2goaGFzaCwgcHJvamVjdCk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgc2V0dXBTY3JpcHRFbnZpcm9ubWVudChwcm9qZWN0OiBQcm9qZWN0LCBlbnY6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pIHtcbiAgICAgICAgaWYgKGluc3RhbGxpbmcpIHJldHVybjtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGhhc2ggPSBjYWxjUGFja2FnZUhhc2gocHJvamVjdCk7XG4gICAgICAgICAgaWYgKGhhc2ggJiYgaGFzaCA9PT0gcmVhZFBhY2thZ2VIYXNoKHByb2plY3QpKSByZXR1cm47XG5cbiAgICAgICAgICAvLyBVcGRhdGUgaGFzaCB0byBhdm9pZCBhbiBpbmZpbml0ZSBsb29wXG4gICAgICAgICAgaWYgKCF3cml0ZVBhY2thZ2VIYXNoKGhhc2gsIHByb2plY3QpKSByZXR1cm47XG5cbiAgICAgICAgICAvLyBOb3RlOiB3ZSBjYW5ub3QgcHJpbnQgYW55dGhpbmcgYmVjYXVzZSB5YXJuIHByb2JhYmx5IHRha2VzIG92ZXIgdGhlIHN0YW5kYXJkIG91dHB1dC5cbiAgICAgICAgICBjb25zb2xlLmluZm8oYCR7cHJlZml4fSBpcyBydW5uaW5nICd5YXJuIGluc3RhbGwnIGR1ZSB0byBkZXBlbmRlbmN5IGNoYW5nZXMuYCk7XG4gICAgICAgICAgY2hpbGRfcHJvY2Vzcy5zcGF3blN5bmMoJ3lhcm4nLCBbJ2luc3RhbGwnXSwgeyBjd2Q6IHByb2plY3QuY3dkLCBlbnYgfSk7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGAke3ByZWZpeH0gZmluaXNoZWQgJ3lhcm4gaW5zdGFsbCcuYCk7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gY2FsY1BhY2thZ2VIYXNoKHByb2plY3Q6IFByb2plY3QpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaGFzaCA9IGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKTtcbiAgICAgICAgY29uc3QgeWFybkxvY2tGaWxlID0gcGF0aC5qb2luKHByb2plY3QuY3dkLCAneWFybi5sb2NrJyk7XG4gICAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyh5YXJuTG9ja0ZpbGUsIHsgdGhyb3dJZk5vRW50cnk6IGZhbHNlIH0pO1xuICAgICAgICBpZiAoc3RhdCkge1xuICAgICAgICAgIGhhc2gudXBkYXRlKGZzLnJlYWRGaWxlU3luYyh5YXJuTG9ja0ZpbGUsICd1dGY4JykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCB3b3Jrc3BhY2VQYXRoIG9mIHByb2plY3Qud29ya3NwYWNlcy5tYXAoKHcpID0+IHcuY3dkKS5zb3J0KCkpIHtcbiAgICAgICAgICBjb25zdCBwYWNrYWdlSnNvbkZpbGUgPSBwYXRoLmpvaW4od29ya3NwYWNlUGF0aCwgJ3BhY2thZ2UuanNvbicpO1xuICAgICAgICAgIGNvbnN0IHBhY2thZ2VKc29uID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocGFja2FnZUpzb25GaWxlLCAndXRmOCcpKTtcbiAgICAgICAgICBjb25zdCBkZXBzS2V5cyA9IE9iamVjdC5rZXlzKHBhY2thZ2VKc29uKS5maWx0ZXIoKGtleSkgPT4ga2V5LmVuZHNXaXRoKCdlcGVuZGVuY2llcycpKTtcbiAgICAgICAgICBjb25zdCBkZXBzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGRlcHNLZXlzKSB7XG4gICAgICAgICAgICBkZXBzLnB1c2goLi4uT2JqZWN0LmVudHJpZXMocGFja2FnZUpzb25ba2V5XSkubWFwKChbbmFtZSwgdmVyXSkgPT4gYCR7bmFtZX06ICR7dmVyfWApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaGFzaC51cGRhdGUoZGVwcy5zb3J0KCkuam9pbignLCcpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFzaC5kaWdlc3QoJ2hleCcpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWFkUGFja2FnZUhhc2gocHJvamVjdDogUHJvamVjdCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBoYXNoRGlyID0gZ2V0SGFzaERpclBhdGgocHJvamVjdCk7XG4gICAgICAgIHJldHVybiBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKGhhc2hEaXIsICdoYXNoJyksICd1dGY4Jyk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gZG8gbm90aGluZ1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHdyaXRlUGFja2FnZUhhc2goaGFzaDogc3RyaW5nIHwgdW5kZWZpbmVkLCBwcm9qZWN0OiBQcm9qZWN0KTogYm9vbGVhbiB7XG4gICAgICBpZiAoIWhhc2ggfHwgaGFzaCA9PT0gbGFzdEhhc2gpIHJldHVybiBmYWxzZTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaGFzaERpciA9IGdldEhhc2hEaXJQYXRoKHByb2plY3QpO1xuICAgICAgICBmcy5ta2RpclN5bmMoaGFzaERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICAgIGZzLndyaXRlRmlsZVN5bmMocGF0aC5qb2luKGhhc2hEaXIsICdoYXNoJyksIGhhc2gpO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHBhdGguam9pbihoYXNoRGlyLCAnLmdpdGlnbm9yZScpLCAnLmdpdGlnbm9yZVxcbmhhc2gnKTtcbiAgICAgICAgY29uc29sZS5pbmZvKGAke3ByZWZpeH0gdXBkYXRlZCBkZXBlbmRlbmN5IGhhc2g6ICR7aGFzaH1gKTtcbiAgICAgICAgbGFzdEhhc2ggPSBoYXNoO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEhhc2hEaXJQYXRoKHByb2plY3Q6IFByb2plY3QpOiBzdHJpbmcge1xuICAgICAgcmV0dXJuIHBhdGguam9pbihwcm9qZWN0LmN3ZCwgJy55YXJuJywgJ3BsdWdpbnMnLCAncGx1Z2luLWF1dG8taW5zdGFsbCcpO1xuICAgIH1cbiAgICByZXR1cm4geyBob29rcyB9O1xuICB9LFxufTtcbiJdLCJuYW1lcyI6WyJpbmRleCIsIm5hbWUiLCJmYWN0b3J5IiwiaW1wb3J0UGFja2FnZSIsImNoaWxkX3Byb2Nlc3MiLCJjcnlwdG8iLCJmcyIsInBhdGgiLCJwcmVmaXgiLCJwcm9jZXNzIiwiZW52IiwiVkVSU0lPTiIsImluc3RhbGxpbmciLCJsYXN0SGFzaCIsImNhbGNQYWNrYWdlSGFzaCIsInByb2plY3QiLCJoYXNoIiwiY3JlYXRlSGFzaCIsInlhcm5Mb2NrRmlsZSIsImpvaW4iLCJjd2QiLCJzdGF0U3luYyIsInRocm93SWZOb0VudHJ5IiwidXBkYXRlIiwicmVhZEZpbGVTeW5jIiwid29ya3NwYWNlUGF0aCIsIndvcmtzcGFjZXMiLCJtYXAiLCJ3Iiwic29ydCIsInBhY2thZ2VKc29uRmlsZSIsInBhY2thZ2VKc29uIiwiSlNPTiIsInBhcnNlIiwiZGVwc0tleXMiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwia2V5IiwiZW5kc1dpdGgiLCJkZXBzIiwicHVzaCIsImVudHJpZXMiLCJ2ZXIiLCJkaWdlc3QiLCJyZWFkUGFja2FnZUhhc2giLCJoYXNoRGlyIiwiZ2V0SGFzaERpclBhdGgiLCJ3cml0ZVBhY2thZ2VIYXNoIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwid3JpdGVGaWxlU3luYyIsImNvbnNvbGUiLCJpbmZvIiwiaG9va3MiLCJ2YWxpZGF0ZVByb2plY3QiLCJhZnRlckFsbEluc3RhbGxlZCIsInNldHVwU2NyaXB0RW52aXJvbm1lbnQiLCJzcGF3blN5bmMiXSwibWFwcGluZ3MiOiJhQUlBLElBQWVBLEVBQUEsQ0FDYkMsS0FBTSxzQkFFTkMsUUFBVUMsSUFFUixNQUFNQyxFQUFnQkQsRUFBYyxpQkFDOUJFLEVBQVNGLEVBQWMsVUFDdkJHLEVBQUtILEVBQWMsTUFDbkJJLEVBQU9KLEVBQWMsUUFFckJLLEVBQVMsd0JBQXdCQyxRQUFRQyxJQUFJQyxVQUNuRCxJQUFJQyxHQUFhLEVBQ2JDLEVBQVcsR0FxQ2YsU0FBU0MsRUFBZ0JDLEdBQ3ZCLElBQ0UsTUFBTUMsRUFBT1gsRUFBT1ksV0FBVyxVQUN6QkMsRUFBZVgsRUFBS1ksS0FBS0osRUFBUUssSUFBSyxhQUMvQmQsRUFBR2UsU0FBU0gsRUFBYyxDQUFFSSxnQkFBZ0IsS0FFdkROLEVBQUtPLE9BQU9qQixFQUFHa0IsYUFBYU4sRUFBYyxTQUc1QyxJQUFLLE1BQU1PLEtBQWlCVixFQUFRVyxXQUFXQyxLQUFLQyxHQUFNQSxFQUFFUixNQUFLUyxPQUFRLENBQ3ZFLE1BQU1DLEVBQWtCdkIsRUFBS1ksS0FBS00sRUFBZSxnQkFDM0NNLEVBQWNDLEtBQUtDLE1BQU0zQixFQUFHa0IsYUFBYU0sRUFBaUIsU0FDMURJLEVBQVdDLE9BQU9DLEtBQUtMLEdBQWFNLFFBQVFDLEdBQVFBLEVBQUlDLFNBQVMsaUJBQ2pFQyxFQUFpQixHQUN2QixJQUFLLE1BQU1GLEtBQU9KLEVBQ2hCTSxFQUFLQyxRQUFRTixPQUFPTyxRQUFRWCxFQUFZTyxJQUFNWCxLQUFJLEVBQUUxQixFQUFNMEMsS0FBUyxHQUFHMUMsTUFBUzBDLE9BRWpGM0IsRUFBS08sT0FBT2lCLEVBQUtYLE9BQU9WLEtBQUssS0FDL0IsQ0FDQSxPQUFPSCxFQUFLNEIsT0FBTyxNQUNyQixDQUFFLE1BQ0EsQ0FFSixDQUVBLFNBQVNDLEVBQWdCOUIsR0FDdkIsSUFDRSxNQUFNK0IsRUFBVUMsRUFBZWhDLEdBQy9CLE9BQU9ULEVBQUdrQixhQUFhakIsRUFBS1ksS0FBSzJCLEVBQVMsUUFBUyxPQUNyRCxDQUFFLE1BQ0EsQ0FFSixDQUVBLFNBQVNFLEVBQWlCaEMsRUFBMEJELEdBQ2xELElBQUtDLEdBQVFBLElBQVNILEVBQVUsT0FBTyxFQUV2QyxJQUNFLE1BQU1pQyxFQUFVQyxFQUFlaEMsR0FDL0JULEVBQUcyQyxVQUFVSCxFQUFTLENBQUVJLFdBQVcsSUFDbkM1QyxFQUFHNkMsY0FBYzVDLEVBQUtZLEtBQUsyQixFQUFTLFFBQVM5QixHQUM3Q1YsRUFBRzZDLGNBQWM1QyxFQUFLWSxLQUFLMkIsRUFBUyxjQUFlLG9CQUNuRE0sUUFBUUMsS0FBSyxHQUFHN0MsOEJBQW1DUSxLQUNuREgsRUFBV0csQ0FDYixDQUFFLE1BQ0EsQ0FFRixPQUFPLENBQ1QsQ0FFQSxTQUFTK0IsRUFBZWhDLEdBQ3RCLE9BQU9SLEVBQUtZLEtBQUtKLEVBQVFLLElBQUssUUFBUyxVQUFXLHNCQUNwRCxDQUNBLE1BQU8sQ0FBRWtDLE1BeEZZLENBQ25CQyxlQUFBQSxDQUFnQnhDLEdBQ2RILEdBQWEsRUFDYixNQUFNSSxFQUFPRixFQUFnQkMsR0FDekJDLEdBQVFBLElBQVM2QixFQUFnQjlCLElBRXJDaUMsRUFBaUJoQyxFQUFNRCxFQUN4QixFQUNEeUMsaUJBQUFBLENBQWtCekMsR0FDaEJILEdBQWEsRUFDYixNQUFNSSxFQUFPRixFQUFnQkMsR0FDekJDLEdBQVFBLElBQVM2QixFQUFnQjlCLElBRXJDaUMsRUFBaUJoQyxFQUFNRCxFQUN4QixFQUNELDRCQUFNMEMsQ0FBdUIxQyxFQUFrQkwsR0FDN0MsSUFBSUUsRUFFSixJQUNFLE1BQU1JLEVBQU9GLEVBQWdCQyxHQUM3QixHQUFJQyxHQUFRQSxJQUFTNkIsRUFBZ0I5QixHQUFVLE9BRy9DLElBQUtpQyxFQUFpQmhDLEVBQU1ELEdBQVUsT0FHdENxQyxRQUFRQyxLQUFLLEdBQUc3QywwREFDaEJKLEVBQWNzRCxVQUFVLE9BQVEsQ0FBQyxXQUFZLENBQUV0QyxJQUFLTCxFQUFRSyxJQUFLVixRQUNqRTBDLFFBQVFDLEtBQUssR0FBRzdDLDZCQUNsQixDQUFFLE1BQ0EsQ0FFSixHQXdEYyJ9
