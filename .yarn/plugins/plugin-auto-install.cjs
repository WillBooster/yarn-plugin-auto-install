"use strict";var n={name:"plugin-auto-install",factory:n=>{const t=n("child_process"),e=n("crypto"),r=n("fs"),c=n("path"),s=`plugin-auto-install v${process.env.VERSION}`;let o=!1,i="";function a(n){try{const t=e.createHash("sha256"),s=c.join(n.cwd,"yarn.lock");r.statSync(s,{throwIfNoEntry:!1})&&t.update(r.readFileSync(s,"utf8"));for(const e of n.workspaces.map((n=>n.cwd)).sort()){const n=c.join(e,"package.json"),s=JSON.parse(r.readFileSync(n,"utf8")),o=Object.keys(s).filter((n=>n.endsWith("ependencies"))),i=[];for(const n of o)i.push(...Object.entries(s[n]).map((([n,t])=>`${n}: ${t}`)));t.update(i.sort().join(","))}return t.digest("hex")}catch{}}function u(n){try{const t=d(n);return r.readFileSync(c.join(t,"hash"),"utf8")}catch{}}function l(n,t){if(!n||n===i)return!1;try{const e=d(t);r.mkdirSync(e,{recursive:!0}),r.writeFileSync(c.join(e,"hash"),n),r.writeFileSync(c.join(e,".gitignore"),".gitignore\nhash"),console.info(`${s} updated dependency hash: ${n}`),i=n}catch{}return!0}function d(n){return c.join(n.cwd,".yarn","plugins","plugin-auto-install")}return{hooks:{validateProject(n){o=!0;const t=a(n);t&&t===u(n)||l(t,n)},afterAllInstalled(n){o=!1;const t=a(n);t&&t===u(n)||l(t,n)},async wrapScriptExecution(n,e,r,c,i){if(o)return n;try{const r=a(e);if(r&&r===u(e))return n;if(!l(r,e))return n;console.info(`${s} is running 'yarn install' due to dependency changes.`),t.spawnSync("yarn",["install"],{cwd:i.cwd,env:i.env}),console.info(`${s} finished 'yarn install'.`);const o=t.spawnSync("yarn",["run",c,...i.args],{cwd:i.cwd,env:i.env,stdio:"inherit",shell:!0});return async()=>o.status||0}catch{}return n}}}}};module.exports=n;
//# sourceMappingURL=index.js.map
